% !TEX root = nov.tex
\section{Introduction}
UNDER CONSTRUCTION\\
When working with valued fields, it is often natural to consider many-sorted languages, where we not only have a field sort $K$, but also sorts for the value group $\Gamma_K$ or the residue field $k_K$. Traditionally, the field sort is considered to be the main sort, and the focus is on which sets in the main sort are definable. The other sorts are auxiliary to this end.

This paper is a first exploration into a minimality concept for p-adically closed fields, where we consider both the field sort and the \emph{auxiliary} sort $\Gamma_K$ to be of equal importance. More specifically, we will consider the following minimality concept. Let $(K, \Gamma_K;\Lm_2)$ be a two-sorted structure, where $\cL$, the language for the $K$-sort is an expansion of the ring language $\Lring$. Associated to $\cL$ is the two-sorted language $\cL_2$ which consists of a sort for $K$ in $\cL$, a sort for $\Gamma_K\cup\{+\infty\}$ in the language of Presburger arithmetic $\cL_{Pres}$ and the valuation map $\ord: K\to \Gamma_K\cup\{+\infty\}$. If the language $\Lm_2$ is clear from the context, we will just write $(K, \Gamma_K)$.
\begin{defn}
An $\Lm_2$-structure $(K,\Gamma_K)$ is \emph{relatively $P$-minimal} (relative to the sort $\Gamma_K$), if, for any elementary equivalent $\Lm_2$-structure $(K',\Gamma_{K'})$, every $\Lm_2$-definable subset $X\subseteq K'\times \Gamma_{K'}$ is already $\cL_{\rm ring, 2}$-definable.
\end{defn}

%Let $\cL_{\rm ring}$ be the ring language and let $\cL$ be a language containing $\cL_{\rm ring}$. Associated to $\cL$ is the two-sorted language $\cL_2$ which consists of a sort for $K$ in $\cL$, a sort for $\Gamma_K\cup\{+\infty\}$ in the language of Presburger arithmetic $\cL_{Pres}$ and the valuation map $\ord: K\to \Gamma_K\cup\{+\infty\}$.

 Our main motivation to consider such structures is an interest in the behavior of definable functions. {\color{red} add comment about  similar motivations in C-minimality} In order to prove certain rationality results, Denef introduced the following class of functions: 

\begin{defn}
Let $X$ be an $\cL_2$-definable set. Write $\AA_{q_K}$ for the ring \[\AA_{q_K}:=\ZZ\left[q_K, q_K^{-1}, \left(\frac1{1-q_K^{-i}}\right)_{i\in \NN, i>0}\right].\]
Call a function $f:X\to \QQ$ $\cL$-constructible (or $\cL_2$-constructible) if it is contained in the $\AA_{q_K}$-algebra generated by functions of the forms
\begin{enumerate}
\item $\alpha:X\to \ZZ$
\item $X\to \ZZ:x\mapsto q_K^{\beta(x)}$,
\end{enumerate}
where $\alpha$ and $\beta$ are $\cL_2$-definable and $\ZZ$-valued.  
\end{defn}

When $\cL$ is $\cL_{\rm ring}$, the subanalytic language $\Lm_{an}$ on $K$ (see \ref{eq:subanalytic}) or some intermediary languages as in \cite{CLip}, the class of $\Lm$-constructible functions is known to be stable under integration (see \cite{denef-2000}, \cite{Clu-2003}, and \cite{Clu-Gor-Hal-14} for the most convenient dealing with integrability conditions). These structures are the main examples of $P$-minimal structures, following the notion developed by Haskell and Macpherson \cite{has-mac-97}. However, it is not known whether the analogous class of functions, build up from definable functions in a general $P$-minimal structure always has this stability property. 

In order to prove that a class of functions is stable integration, one needs to control the behavior of the functions involved.% by showing that there exists a partitioning of the domain where the functions can be assumed to have a certain form. 

Such a \emph{preparation theorem}, based on cell-decomposition is indeed the main ingredient in the proof for the semi-algebraic and subanalytic cases.
However, a similar theorem currently does not exist in the $P$-minimal context. Mourgues \cite{mou-09} proved a somewhat weaker form of cell decomposition under the assumption of Skolem functions on $(K,\cL)$, but without function preparation.
\\
-----------------------------------------------------------------------------------------------------
\\

this form of cell decomposition seems not enough to show stability under integration. The idea of relative $P$-minimality is to bring into account the value group in the definition of minimality as follows:

\begin{defn}
Call the $\Lm_2$-structure $(K,\Gamma_K)$ \emph{relatively $P$-minimal} (relative to the sort $\Gamma$), if, for any elementary equivalent $\Lm_2$-structure $(K',\Gamma_{K'})$, any $\Lm_2$-definable subset $X\subseteq K'\times \Gamma_{K'}$ is already $\cL_{\rm ring, 2}$-definable.
\end{defn}
Here, $\Gamma_{K'}$ stands for the value group of $K'$. When $\cL$ is $\cL_{\rm ring}$ or $\Lm_{an}$, the $\Lm_2$-structure $(K,\Gamma_K)$ is relative $P$-minimal (as we will show in Lemma \ref{lem:suban}). The preparation theorem that we show is the following:  

\begin{thm}[Preparation theorem for relative $P$-minimality]\label{thm:partialprep} 
Let $(K,\Gamma_K)$ be relatively $P$-minimal $\Lm_2$-structure. Let $S\subseteq K^l\times\Gamma^l$ and $X \subseteq S \times K$ be $\Lm_2$-definable sets, and $f:X\rightarrow \Gamma_k$ be an $\Lm_2$-definable function. There exists a finite decomposition of $X$ into cells $C$ of the form  
\[C = \left\{(s,t) \in D\times K \ \left| \ \begin{array}{l} \alpha(s) \square_1 \ \ord(t-c(s)) \ \square_2 \ \beta(s),\\ \ord(t-c(s)) \equiv k\mod n,\\ \ac_{m}(t-c(s)) = \xi \end{array} \right\}\right..\]
On each such cell $C$, there is a $\Lm_2$-definable function $\gamma:D\to\Gamma_K$ and an integer $a\in \ZZ$ such that for all $(s,t) \in C$, 
\[f(s,t) = \gamma(s) + a\frac{\ord(t-c(s))-k}{n}.\]
We stress that the functions $c: S\to K$ are NOT necessarily $\Lm_2$-definable.
\end{thm}

As an application we are able to show (for a more precise statement see \ref{thm:integration}): 

\begin{thm*}
Let $(K, \Z)$ be a relatively $P$-minimal structure, $S$ an $\Lm_2$-definable set and $f: X \subseteq S\times K^m \to \AA_{q_K}$ a constructible function.  There exists a constructible function $g: S \to \AA_{q_K}$, such that
\[g(s) = \int_{X_s} f(s,x)|dx|,\]
whenever $f(s, \cdot)$ is measurable and integrable on the fiber $Y_s$.
\end{thm*}

We also extend the rationality results so far known only for the semi-algebraic \cite{denef-84} and subanalytic setting \cite{denef-vdd-88} (and thus also for any sublanguage), obtaining the follwing:

\begin{thm}\label{thm:rationality}
Suppose that $(K,\cL)$ is relatively $P$-minimal. Let $X$ be a $\cL_2$-definable subset of $\cO_K^n\times \NN$, and let $a_n$ be the Haar measure of $X_n:=\{x\in \cO_K^n\mid (x,n)\in X\}$ for each $n\geq 0$. Then the series $\sum_{i\geq 0} a_i T^i$ is rational. 
\end{thm}
Here, we normalize the Haar measure on $K^n$ so that $\cO_K^n$ has measure $1$. For a more general version see Theorem \ref{thm:rationalitygeneral}.  

\

The article is presented as follows. Section 2 is devoted to prove the preparation theorem for relative $P$-minimal structures. Sections 3 and 4 correspond respectively to the integration and rationality results. Finally, in section 5 we discuss generalities about the notion of relative $P$-minimality and its relation with classical $P$-minimality. Our arguments will use a result on definable sets of Presburger arithmetic that we include an appendix about ordered structures. 

\subsection{Preliminaries}

Let $(K,\Gamma_K)$ be a $\cL_2$-structure. By a definable set we mean an $\Lm_2$-definable set allowing parameters. For notational purposes we will fix a definable set $S \subseteq K^{m_0} \times \Gamma_K^{m_0}$ which we call a \emph{parameter set}. For a definable set $X\subseteq S\times K$ and $s\in S$, $X_s:=\{x\in K: (s,x)\in X\}$ denotes the fiber over $s$. Analogously, for a definable function $f:X\rightarrow \Gamma_K$, $f_s$ denotes the function $f(s,\cdot):X_s\rightarrow \Gamma_K$. Given two sets $A$ and $B$, we denote by $\Pi_{A}:A\times B\to A$ for the projection onto $A$ and by $\Pi_B:A\times B\to B$ the projection onto $B$. For a positive integer $n\geq 1$, $A^{\leq n}$ denotes $\bigcup_{i=1}^n A^i$. We start defining cells in this context: 

\begin{defn}[Cells]\label{def:cell} Let $(K,\Gamma_K)$ be a $\cL_2$-structure.  
\begin{itemize}[leftmargin=*]
\item A subset $C\subseteq S\times K$ is a $K$-cell if it is of the form 
\[C = \left\{(s,t) \in D\times K \ \left| \ \begin{array}{l} \alpha(s) \square_1 \ \ord(t-c(s)) \ \square_2 \ \beta(s),\\ \ord(t-c(s)) \equiv k\mod n,\\ \ac_{m}(t-c(s)) = \xi \end{array} \right\}\right.,\]
where $D$ is a definable subset of $S$, $c$ is a function $c:D\to K$, $\alpha, \beta$ are $\Lm_2$-definable functions $D\to\Gamma_k$, $k, n, m \in \NN$, $\xi \in \ac_{m}(K)$ and the squares $\square_i$ may denote $<$ or \emph{no condition}. If the function $c$ is definable, we say that the cell has \emph{definable centers}.  
\item A subset $B\subseteq S\times \Gamma_K$ is a $\Gamma$-cell if it is of the form
\[B= \left\{(s,\gamma)\in D\times \Gamma_K \left|\begin{array}{l} \alpha(s) \square_1 \ \gamma \ \square_2 \ \beta(s), \\
\gamma \equiv k\mod n \end{array}\right\}\right.,\]
where $D$ is an definable subset of $S$, $\alpha, \beta$ are definable functions $D\to\Gamma_k$, $k, n\in \NN$ and again the squares $\square_i$ may denote $<$ or \emph{no condition}.  
\end{itemize}
\end{defn}

We call \emph{cell} a subset which is either a $K$-cell or a $\Gamma$-cell. Given cells $C$ and $B$ as in the previous definition we call the tuples $(\square,k,n,m,\xi)$ and $(\square,k,n)$ \emph{the type} of $C$ and $B$ respectively. We denote by $P_K$ (resp. $P_\Gamma$) the set of all possible types of $K$-cells (resp. $\Gamma$-cells), that is, the set of tuples $(\square,k,n,m,\xi)$  (resp. $(\square,k,n)$) where $\square = (\square_1, \square_2) \in \{\emptyset, <\}^{2}$, $(k,n,m)$ its a triple of positive integers such that $k<n$, and $\xi\in \ac_{m}(K)$. For $\delta=(\square,k,n,m,\xi)\in P_K$, $\lambda=(\square,k,n)\in P_{\Gamma}$, $\alpha,\beta,\gamma$ variables of type $\Gamma$ and $x,y$ variables of type $K$, we define the formulas
\begin{equation}\label{defKcells}
C_\delta(x,y,\alpha,\beta):= \left(\begin{array}{l} \alpha \square_1 \ \ord(x-y) \ \square_2 \ \beta \ \wedge\\ \ord(x-y) \equiv k\mod n \ \wedge\\ \ac_{m}(x-y) = \xi \end{array} \right),
\end{equation}
\begin{equation}\label{defGammacells}
B_\lambda(\alpha,\beta,\gamma):= \left(\begin{array}{l} \alpha \square_1 \ \gamma \ \square_2 \ \beta \ \wedge \\
\gamma \equiv k\mod n \end{array}\right).
\end{equation}

Notice that for a definable subset $C\subseteq S\times K$, we can now express the fact that $C$ is a cell with definable centers claiming the existence of definable functions $\alpha,\beta:\Pi_S(C)\to\Gamma_K$, $c:\Pi_S(C)\to K$ and of a tuple $\delta\in P_K$ such that 
\[C = \left\{(s,t) \in \Pi_S(C)\times K \ \left| \ (K,\Gamma_K)\models C_\delta(t,c(s),\alpha(s),\beta(s))\right\}\right..
\]
Analogously, for a definable subset $B\subseteq S\times \Gamma_K$, $B$ is a cell if there are definable functions $\alpha,\beta:\Pi_S(C)\to\Gamma_K$ and an tuple $\lambda\in P_\Gamma$ such that  
\[B = \left\{(s,\gamma) \in \Pi_S(B) \times \Gamma \ \left| \ (K,\Gamma_K)\models B_\lambda(\alpha(s),\beta(s),\gamma)\right\}\right..
\]



